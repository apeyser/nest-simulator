branches:
  except:
    - gh-pages
language: cpp
compiler:
  - gcc
 
#For Ubuntu Trusty (14.04 LTS)
dist: trusty

env:
  matrix:
    - xGSL=1 xMPI=0 xPYTHON=1
    - xGSL=0 xMPI=1 xPYTHON=1
    - xGSL=1 xMPI=1 xPYTHON=1
    - xGSL=0 xMPI=1 xPYTHON=0
    - xGSL=1 xMPI=1 xPYTHON=0
    - xGSL=1 xMPI=0 xPYTHON=0
    - xGSL=0 xMPI=0 xPYTHON=1
    - xGSL=0 xMPI=0 xPYTHON=0
  global:
   # - ARTIFACTS_TARGET_PATHS="artifacts/$TRAVIS_BUILD_NUMBER/$TRAVIS_JOB_NUMBER:artifacts/$TRAVIS_COMMIT"
    #- ARTIFACTS_DEBUG=1
    - "ARTIFACTS_AWS_REGION=eu-central-1"
    - "ARTIFACTS_S3_BUCKET=nest-travis-artefacts"
    - SECURE: "cvyNpbJTTy+yGk76qH8Ibbp/gVmvN71Pe9pt+v2xxUKqBznJ3ruBLFKAkHLurYiAIuL/I/fo5cUiJBheu+LdUwBi36oJ8Z9hrojPdzLXzn3iRKbKrgLC0ZicjGl0Db97dQiOvXV90lZoMeGLypTNL90Hquj8ASA6W485HAEGgJI="
    - SECURE: "RFif0aY1uTjmjBLr2xJZVFcSnDOQVDeNeJSyRQnphxyhEY7tHS4h+r6/53YBEBE3MCWvnwsnamdrLAOcvwyuHSoRLgDzIMg2OyUDFHARcQypBjkYjlEemuwENX9r08RZPT71nkg0GRDWtF3OxiVdR64WL9u22ifPLj7knZf3UcM="

matrix:
 # do notify immediately about it when a job of a build fails.
  fast_finish: true
branches:
 only:
  - master
cache:
  apt: true 
  ccache: true
  pip: true
#virtualenv:
 # system_site_packages: true
#addons:
 # artifacts:
 #  debug: true
#addons:
#  artifacts: true 

before_install:
  - echo $LANG
  - echo $LC_ALL

  #- if [ $TRAVIS_OS_NAME == linux ]; then sudo apt-get update && sudo apt-get install -y llvm-3.4 llvm-3.4-dev; fi
  - sudo rm -rf /var/lib/apt/lists/*
  - ls /etc/apt/sources.list.d/
 # - sudo rm /etc/apt/sources.list.d/docker-source.list
  # get repository for clang-3.6 stuff (including clang-format-3.6)
  - sudo sh -c 'echo -n "deb http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.6 main" >> /etc/apt/sources.list'
  # add key from ^ repository
  - wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -

  # update repository status (-qq is more quiet)
  - sudo apt-get update -qq
  #Upgrade pip
  #- pip install --upgrade pip
  - wget https://raw.github.com/pypa/pip/master/contrib/get-pip.py
  - sudo python get-pip.py
  
  - sudo apt-get install -y  coreutils gawk mawk original-awk
  # some basic package build tools:
  - sudo apt-get install -y devscripts build-essential
  # remove any obsolete libraries
  - sudo apt-get autoremove

  # For NEST ConnPlotter tutorial
  - sudo apt-get install -y texlive-latex-extra
  
  #Clang
  - sudo apt-get install -y clang indent
  
  # Required by Topographica
  #- sudo apt-get install xorg-x11-server-Xvfb pylint pyflakes
  
  # Required by NEST, PyNN and Topographica
  - sudo apt-get install -y python-debian python-numpy python-scipy python-virtualenv python-matplotlib python-tk
  
  # Required by Sumatra and PyNN
  - sudo apt-get install -y python-coverage python-nose python-setuptools
  - sudo apt-get install -y python-mpi4py openmpi-bin openmpi-doc libopenmpi-dev
  
  #python 3
  - sudo apt-get install -y python3 ipython3 python3-all-dev python3-dev python3-numpy python3-scipy python3-nose
  
  #- sudo pip install cython==0.21.1
  - pip install --user cython==0.21.1
  - sudo pip install -U setuptools
  
  # Needed for documentation, e.g. NEST examples
  - sudo apt-get install -y texlive texlive-latex-base texlive-latex3 ghostscript
  
  #Build dependencies for NEST
  - sudo apt-get install -y autoconf automake libtool libltdl-dev
  - sudo apt-get install -y libgsl0-dev  libghc-readline-dev gsl-bin libgsl0-dbg libgsl0ldbl
  
  #Build dependencies for Sumatra
  - sudo apt-get install -y python-django python-django-tagging python-httplib2 python-simplejson python-svn git-svn
  
  #Build dependencies for PyNN
  - sudo apt-get install -y python-cheetah python-jinja2 python-mock
  
  #Build dependencies for Topographica
  - sudo apt-get install -y python-tk python-gmpy python-imaging python-imaging-tk

  - sudo apt-get install -y cvs e2fsprogs gettext libpackagekit-glib2-dev groff libssh2-1-dev python-libssh2 slang-gsl libncurses5-dev check

  # for checking coding style (clang-format-3.6 depends on libllvm3.6)
  - sudo apt-get install clang-format-3.6

  #cppcheck
  - sudo apt-get install cppcheck
  #vera++
  - sudo apt-get install vera++

install: 
  - cppcheck --version
  - cython --version
  - python --version
before_script:
  - chmod +x build.sh 
  - "gem install travis-artifacts"

script: ./build.sh  

after_script:
#  - "travis-artifacts upload --path $TRAVIS_BUILD_DIR/build"
  - "travis-artifacts upload --path $TRAVIS_BUILD_DIR/build --target-path artifacts/$TRAVIS_BRANCH/$TRAVIS_BUILD_NUMBER"
 # - "travis-artifacts upload --path logs --path /home/travis/build/INM-6/nest-git-migration/build:build_logs"
#after_failure:
#  - "travis-artifacts upload --path debug/debug.log"
#after_success:
#  - "travis-artifacts upload --path build/build.tar.gz"
  
#after_test:
  #- "travis_artifacts upload --target-path artifacts/$TRAVIS_BUILD_ID/$TRAVIS_JOB_ID"
 # - "travis_artifacts upload --target-path ARTIFACTS_TARGET_PATHS"
#S3 deployment    

#deploy:
#  provider: s3
  #access_key_id: 
  #  secure: H/omZa5BH3x2rZZ1e3KDxpiUtzMucF9/t420IcrvHiNbSvju6DacOdq6etAW4bVnhK+5b5kDu4e/Ee4C+iu43YBNPdQscGIy0mT8ePSMgP+r9dw08ZIoMQsMm57SKljfQsVyw1tj+r6iwQ2AkE9fIb3xNM/Yj3z0sEVoDbIgRV0=
#  access_key_id: AKIAIC2R6KWR5DF2W6WQ
 # secret_access_key:
 #   secure: S3VD97LZzUgCOPt7Ho0CD5kUsIxM87plqM7XT3Wu6EG1uxKvMvBN4V0eEkuBq9aWAJzfamD36h3KgwSDuDVTkUiAy186LUIWjcUcuWssLiBxRjNBNF8LGzaDKRNfKXwyzeJst8wqNhIv2r+Es3d7pbIsJJ61tGfBAEInMXI3his=
#  bucket: "nest-travis-artefacts"
#  skip_cleanup: true
#  endpoint: s3.eu-central-1.amazonaws.com
 # region: eu-central-1
#  local-dir: "$TRAVIS_BUILD_DIR/build"
#  acl: bucket_owner_full_control  


  
